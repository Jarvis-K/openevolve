<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenEvolve Islands & Learning Curve Demo</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --toolbar-bg: #ffffff;
            --sidebar-bg: #f8fafc;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
            --main-bg: #f1f5f9;
            --muted-text: #64748b;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--main-bg);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-color);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--toolbar-bg);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .tab {
            padding: 10px 20px;
            background: #e2e8f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: #cbd5e1;
        }

        .tab.active {
            background: #3b82f6;
            color: white;
        }

        .view {
            display: none;
            background: var(--toolbar-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .view.active {
            display: block;
        }

        /* Islands styles */
        .islands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .island-card {
            background: var(--sidebar-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .island-card.current {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .island-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .island-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .island-header h3 {
            margin: 0;
            color: var(--text-color);
            font-size: 16px;
        }

        .island-status {
            font-size: 14px;
        }

        .current-badge {
            background: #3b82f6;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .island-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat {
            display: flex;
            flex-direction: column;
        }

        .stat label {
            font-size: 11px;
            color: var(--muted-text);
            text-transform: uppercase;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .stat value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-color);
        }

        /* Learning curve styles */
        #learning-curve-chart {
            margin-bottom: 20px;
        }

        .code-viewer {
            background: var(--main-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            display: none;
        }

        .code-viewer h3 {
            color: var(--text-color);
            margin-top: 0;
            margin-bottom: 15px;
        }

        .code-viewer pre {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.4;
            margin: 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .tooltip {
            position: absolute;
            background: var(--toolbar-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 8px;
            font-size: 12px;
            color: var(--text-color);
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .grid line {
            stroke: var(--border-color);
        }

        .grid path {
            stroke-width: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ OpenEvolve Islands & Learning Curve Demo</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showView('islands')">üèùÔ∏è Islands Status</button>
            <button class="tab" onclick="showView('learning')">üìà Learning Curve</button>
        </div>

        <div id="view-islands" class="view active">
            <h2>Islands Status</h2>
            <p>Each card represents an evolution island with its current statistics:</p>
            <div id="islands-grid" class="islands-grid"></div>
        </div>

        <div id="view-learning" class="view">
            <h2>Learning Curve</h2>
            <p>Shows the best score achieved at each iteration. Click on points to view the corresponding code.</p>
            <div id="learning-curve-chart"></div>
            <div id="code-viewer" class="code-viewer">
                <h3>Program Code (Iteration <span id="code-iteration"></span>)</h3>
                <pre id="code-content"></pre>
            </div>
        </div>
    </div>

    <script>
        // Demo data (in a real application, this would come from the API)
        const demoData = {
            islands_stats: [
                {
                    island_id: 0,
                    population_size: 20,
                    best_score: 0.6463,
                    average_score: 0.4121,
                    generation: 15,
                    best_program_id: "abc123",
                    is_current: false
                },
                {
                    island_id: 1,
                    population_size: 24,
                    best_score: 0.9900,
                    average_score: 0.6421,
                    generation: 27,
                    best_program_id: "def456",
                    is_current: false
                },
                {
                    island_id: 2,
                    population_size: 21,
                    best_score: 0.9900,
                    average_score: 0.7810,
                    generation: 29,
                    best_program_id: "ghi789",
                    is_current: true
                },
                {
                    island_id: 3,
                    population_size: 3,
                    best_score: 0.9407,
                    average_score: 0.7606,
                    generation: 27,
                    best_program_id: "jkl012",
                    is_current: false
                }
            ],
            learning_curve: [
                {iteration: 0, score: 0.3952, program_id: "prog1", code: `def optimized_function(x):\n    # Iteration 0, Island 1\n    # Score: 0.3952\n    result = 0\n    for i in range(10):\n        result += x * 0.40 + 0.023\n    return result / 10`},
                {iteration: 1, score: 0.4146, program_id: "prog2", code: `def optimized_function(x):\n    # Iteration 1, Island 0\n    # Score: 0.4146\n    result = 0\n    for i in range(11):\n        result += x * 0.41 + 0.015\n    return result / 11`},
                {iteration: 2, score: 0.4203, program_id: "prog3", code: `import numpy as np\n\ndef evolved_algorithm(data):\n    # Generated at iteration 2 on island 1\n    # Performance score: 0.4203\n    weights = np.array([0.234, 0.567, 0.123])\n    processed = data * weights.sum() * 0.420\n    return processed + 0.045`},
                {iteration: 5, score: 0.4651, program_id: "prog4", code: `class OptimizedSolver:\n    def __init__(self):\n        self.iteration = 5\n        self.island = 2\n        self.score = 0.4651\n        self.params = {"alpha": 0.456, "beta": 0.789, "gamma": 0.234}\n    \n    def solve(self, problem):\n        return problem * self.params['alpha'] + self.score`},
                {iteration: 10, score: 0.6234, program_id: "prog5", code: `def advanced_optimizer(x, y):\n    # Iteration 10 breakthrough\n    # Score: 0.6234\n    optimized = x * 0.62 + y * 0.34\n    for step in range(15):\n        optimized = optimized * 1.01 - 0.001\n    return optimized`},
                {iteration: 15, score: 0.7890, program_id: "prog6", code: `import numpy as np\n\ndef neural_inspired_function(inputs):\n    # Iteration 15 - Neural network inspired\n    # Score: 0.7890\n    weights = np.random.seed(42)\n    weights = np.array([0.789, 0.456, 0.234, 0.567])\n    activation = np.tanh(np.dot(inputs, weights[:len(inputs)]))\n    return activation * 0.789`},
                {iteration: 20, score: 0.8456, program_id: "prog7", code: `def genetic_algorithm_solution(population):\n    # Iteration 20 - GA inspired approach\n    # Score: 0.8456\n    fitness = []\n    for individual in population:\n        fitness.append(individual * 0.845 + 0.011)\n    return max(fitness)`},
                {iteration: 25, score: 0.9123, program_id: "prog8", code: `def hybrid_optimizer(data, params):\n    # Iteration 25 - Hybrid approach\n    # Score: 0.9123\n    result = data\n    for iteration in range(params.get('iterations', 10)):\n        result = result * 0.912 + params.get('learning_rate', 0.01)\n        if result > 1.0:\n            result = 0.912\n    return result`},
                {iteration: 29, score: 0.9900, program_id: "prog9", code: `def ultimate_solution(input_data):\n    # Iteration 29 - Near optimal solution!\n    # Score: 0.9900\n    # This represents the culmination of 29 iterations of evolution\n    \n    # Multi-stage optimization\n    stage1 = input_data * 0.99\n    stage2 = np.log(stage1 + 1) * 1.414  # Golden ratio inspired\n    stage3 = np.tanh(stage2) * 0.99\n    \n    # Final refinement\n    result = stage3 + 0.01 * np.sin(input_data)\n    return min(0.99, max(0.0, result))`}
            ]
        };

        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected view
            document.getElementById(`view-${viewName}`).classList.add('active');
            event.target.classList.add('active');
            
            // Render content based on view
            if (viewName === 'islands') {
                renderIslands();
            } else if (viewName === 'learning') {
                renderLearningCurve();
            }
        }

        function renderIslands() {
            const container = document.getElementById('islands-grid');
            container.innerHTML = '';

            demoData.islands_stats.forEach(island => {
                const card = document.createElement('div');
                card.className = `island-card ${island.is_current ? 'current' : ''}`;
                
                const statusColor = island.population_size > 0 ? '#22c55e' : '#ef4444';
                
                card.innerHTML = `
                    <div class="island-header">
                        <h3>Island ${island.island_id}</h3>
                        <div class="island-status" style="color: ${statusColor}">‚óè</div>
                        ${island.is_current ? '<span class="current-badge">Current</span>' : ''}
                    </div>
                    <div class="island-stats">
                        <div class="stat">
                            <label>Population</label>
                            <value>${island.population_size}</value>
                        </div>
                        <div class="stat">
                            <label>Generation</label>
                            <value>${island.generation}</value>
                        </div>
                        <div class="stat">
                            <label>Best Score</label>
                            <value>${island.best_score.toFixed(4)}</value>
                        </div>
                        <div class="stat">
                            <label>Avg Score</label>
                            <value>${island.average_score.toFixed(4)}</value>
                        </div>
                    </div>
                    <div style="border-top: 1px solid var(--border-color); padding-top: 8px; font-size: 12px;">
                        <span style="color: var(--muted-text); font-weight: 500;">Best Program:</span>
                        <code style="background: #f3f4f6; padding: 2px 4px; border-radius: 3px; font-family: monospace;">${island.best_program_id}</code>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function renderLearningCurve() {
            const container = document.getElementById('learning-curve-chart');
            container.innerHTML = '';

            const margin = { top: 20, right: 30, bottom: 40, left: 60 };
            const width = Math.min(1000, container.offsetWidth) - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;

            const svg = d3.select(container)
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom);

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const learningData = demoData.learning_curve;

            // Scales
            const xScale = d3.scaleLinear()
                .domain(d3.extent(learningData, d => d.iteration))
                .range([0, width]);

            const yScale = d3.scaleLinear()
                .domain(d3.extent(learningData, d => d.score))
                .nice()
                .range([height, 0]);

            // Line generator
            const line = d3.line()
                .x(d => xScale(d.iteration))
                .y(d => yScale(d.score))
                .curve(d3.curveStepAfter);

            // Add grid lines
            g.append('g')
                .attr('class', 'grid')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(xScale)
                    .tickSize(-height)
                    .tickFormat('')
                )
                .style('stroke-dasharray', '3,3')
                .style('opacity', 0.3);

            g.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(yScale)
                    .tickSize(-width)
                    .tickFormat('')
                )
                .style('stroke-dasharray', '3,3')
                .style('opacity', 0.3);

            // Add the line
            g.append('path')
                .datum(learningData)
                .attr('fill', 'none')
                .attr('stroke', '#3b82f6')
                .attr('stroke-width', 2)
                .attr('d', line);

            // Add dots
            g.selectAll('.dot')
                .data(learningData)
                .enter().append('circle')
                .attr('class', 'dot')
                .attr('cx', d => xScale(d.iteration))
                .attr('cy', d => yScale(d.score))
                .attr('r', 4)
                .attr('fill', '#3b82f6')
                .style('cursor', 'pointer')
                .on('mouseover', function(event, d) {
                    d3.select(this).attr('r', 6).attr('fill', '#1d4ed8');
                    showTooltip(event, d);
                })
                .on('mouseout', function(event, d) {
                    d3.select(this).attr('r', 4).attr('fill', '#3b82f6');
                    hideTooltip();
                })
                .on('click', function(event, d) {
                    showCodeViewer(d);
                });

            // Add axes
            g.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(xScale))
                .append('text')
                .attr('x', width / 2)
                .attr('y', 35)
                .attr('fill', 'currentColor')
                .style('text-anchor', 'middle')
                .style('font-size', '12px')
                .text('Iteration Step');

            g.append('g')
                .call(d3.axisLeft(yScale))
                .append('text')
                .attr('transform', 'rotate(-90)')
                .attr('y', -40)
                .attr('x', -height / 2)
                .attr('fill', 'currentColor')
                .style('text-anchor', 'middle')
                .style('font-size', '12px')
                .text('Best Score');

            // Add title
            g.append('text')
                .attr('x', width / 2)
                .attr('y', -5)
                .attr('text-anchor', 'middle')
                .style('font-size', '14px')
                .style('font-weight', 'bold')
                .attr('fill', 'currentColor')
                .text('Learning Curve - Best Score Over Time');
        }

        function showTooltip(event, data) {
            const tooltip = d3.select('body').append('div')
                .attr('class', 'tooltip')
                .style('opacity', 0);

            tooltip.transition()
                .duration(200)
                .style('opacity', .9);

            tooltip.html(`
                <strong>Iteration:</strong> ${data.iteration}<br/>
                <strong>Score:</strong> ${data.score.toFixed(4)}<br/>
                <strong>Program:</strong> ${data.program_id}<br/>
                <em>Click to view code</em>
            `)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 28) + 'px');
        }

        function hideTooltip() {
            d3.selectAll('.tooltip').remove();
        }

        function showCodeViewer(data) {
            const codeViewer = document.getElementById('code-viewer');
            const codeIteration = document.getElementById('code-iteration');
            const codeContent = document.getElementById('code-content');

            codeIteration.textContent = data.iteration;
            codeContent.textContent = data.code || 'No code available';
            codeViewer.style.display = 'block';

            // Scroll to code viewer
            codeViewer.scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize with islands view
        renderIslands();
    </script>
</body>
</html>